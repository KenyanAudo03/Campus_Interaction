{% extends 'base.html' %}

{% block title %}Create Event{% endblock %}
{% load form_tags %}

{% block extra_css %}
<style>
    .hidden { display: none; }
    .step { display: none; }
    .active-step { display: block; }
    .form-navigation { margin-top: 1.5rem; }
    .section-title { font-weight: bold; font-size: 1.2rem; margin-bottom: 1rem; color: #007bff; }
    .step-counter { font-size: 1.1rem; color: #dc3545; font-weight: bold; margin-bottom: 1rem; text-align: center; }
</style>
{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <h2 class="text-center mb-2">Create Event</h2>
            
            <!-- Step Counter at the top, directly below the heading -->
            <div class="step-counter">
                <span id="page-number">1/3</span>
            </div>

            <form method="POST" enctype="multipart/form-data" id="event-form" class="needs-validation" novalidate>
                {% csrf_token %}

                <!-- Step 1: Event Type and Basic Information -->
                <div id="step-1" class="step active-step">
                    <div class="section-title">Step 1: Event Type and Basic Information</div>
                    <div class="mb-3">
                        <label for="id_event_type" class="form-label">Event Type</label>
                        <select id="id_event_type" name="event_type" class="form-control" required>
                            <option value="physical">Physical Event</option>
                            <option value="text">Text-Based Event</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="id_title" class="form-label">Title</label>
                        <input type="text" id="id_title" name="title" class="form-control" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="id_description" class="form-label">Description</label>
                        <textarea id="id_description" name="description" class="form-control" required></textarea>
                    </div>
                </div>

                <!-- Step 2: Text-based or Physical Event Specifics -->
                <div id="step-2" class="step">
                    <div class="section-title">Step 2: Additional Details</div>
                    <!-- Text-based Event Fields -->
                    <div id="text-fields" class="form-section">
                        <div class="mb-3">
                            <label for="id_content" class="form-label">Event Content</label>
                            <textarea id="id_content" name="content" class="form-control"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="id_attachments" class="form-label">Attachments</label>
                            <input type="file" id="id_attachments" name="attachments" class="form-control">
                        </div>
                    </div>
                    <!-- Physical Event Fields -->
                    <div id="physical-fields" class="form-section">
                        <div class="mb-3">
                            <label for="id_location" class="form-label">Location</label>
                            <input type="text" id="id_location" name="location" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label for="id_image" class="form-label">Cover Image</label>
                            <input type="file" id="id_image" name="image" class="form-control" accept="image/*">
                            <div id="image-preview" class="mt-2"></div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Schedule and Settings -->
                <div id="step-3" class="step">
                    <div class="section-title">Step 3: Schedule and Settings</div>
                    <div class="mb-3">
                        <label for="id_start_date" class="form-label">Start Date</label>
                        <input type="datetime-local" id="id_start_date" name="start_date" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label for="id_end_date" class="form-label">End Date</label>
                        <input type="datetime-local" id="id_end_date" name="end_date" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label for="id_max_participants" class="form-label">Max Participants</label>
                        <input type="number" id="id_max_participants" name="max_participants" class="form-control">
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" id="id_is_public" name="is_public" class="form-check-input">
                        <label class="form-check-label" for="id_is_public">Is Public?</label>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="form-navigation text-center">
                    <button type="button" id="prev-btn" class="btn btn-secondary hidden">Previous</button>
                    <button type="button" id="next-btn" class="btn btn-primary">Next</button>
                    <button type="submit" id="submit-btn" class="btn btn-success hidden">Create Event</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        let currentStep = 1;
        const totalSteps = 3;

        const showStep = (step) => {
            document.querySelectorAll('.step').forEach((el, index) => {
                el.classList.toggle('active-step', index === step - 1);
            });
            document.getElementById('prev-btn').classList.toggle('hidden', step === 1);
            document.getElementById('next-btn').classList.toggle('hidden', step === totalSteps);
            document.getElementById('submit-btn').classList.toggle('hidden', step !== totalSteps);

            // Update page number display
            document.getElementById('page-number').textContent = `${step}/${totalSteps}`;
        };

        document.getElementById('next-btn').addEventListener('click', () => {
            if (currentStep < totalSteps) currentStep++;
            showStep(currentStep);
        });

        document.getElementById('prev-btn').addEventListener('click', () => {
            if (currentStep > 1) currentStep--;
            showStep(currentStep);
        });

        // Toggle between text and physical fields based on event type
        const toggleEventTypeFields = () => {
            const eventType = document.getElementById('id_event_type').value;
            document.getElementById('text-fields').style.display = eventType === 'text' ? 'block' : 'none';
            document.getElementById('physical-fields').style.display = eventType === 'physical' ? 'block' : 'none';
        };

        document.getElementById('id_event_type').addEventListener('change', toggleEventTypeFields);
        toggleEventTypeFields();
        showStep(currentStep);

        // Form validation on submit
        document.getElementById('event-form').addEventListener('submit', function(event) {
            const endDateInput = document.getElementById('id_end_date');
            const startDateInput = document.getElementById('id_start_date');
            if (endDateInput.value < startDateInput.value) {
                event.preventDefault(); // Prevent form submission
                alert("End date must be after start date.");
                endDateInput.focus();
            }
        });
    });
</script>
{% endblock %}
