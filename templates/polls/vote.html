{% extends 'base.html' %}

{% block title %}Polls - Create Poll{% endblock %}

{% block content %}

<style>
.titles {
    text-align: center;
    font-size: larger;
    font-weight: 800;
    margin-bottom: 10px;
}

.titles p {
    font-size: small;
    font-size: 13px;
    font-weight: 200;
}

.banner-container {
    position: relative; /* Establishes a positioning context for absolute children */
}

.banner-image {
    width: 100%;
    height: 200px; 
    object-fit: cover; /* Maintain aspect ratio of the image */
    border-radius: 10px; 
    margin-bottom: 20px; 
    filter: blur(1px); /* Apply blur to the image */
    transition: filter 0.3s ease; /* Smooth transition for hover effect */
}

.text-overlay {
    position: absolute; /* Allows overlaying text on the image */
    top: 50%; /* Position the text in the middle */
    left: 50%; /* Center horizontally */
    transform: translate(-50%, -50%); /* Adjust position to truly center */
    color: white; /* White text color for contrast */
    text-align: center; /* Center the text */
    z-index: 1; /* Ensure the text is above the image */
}

form {
    max-width: 600px;
    margin: 0 auto;
    padding: 20px;
    border: 1px solid #000;
    border-radius: 10px;
    margin-top: 25px;
}

@media (max-width: 600px) {
    form {
        padding: 10px; 
    }
}

.polls-options{
    border-bottom: 1px solid #000;
}
.option-container{
margin-bottom: 10px;
background-color: blue;
padding: 15px 10px;
border-radius: 10px;
cursor: pointer;
display: flex;
}

label{
    font-size: 20px;
    color: #fff;
    margin-left: 20px;
}
.actions{
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 20px;
    margin-top: 10px;
    margin-bottom: 0;
   
}
.actions button, .view_result{
    border: none !important;
    font-size: 14px;
    padding: 10px 20px;
    background-color: blue;
    border-radius: 7px;
    cursor: pointer;
    color: #fff;
    text-decoration: none;
}
.polls-options{
    -webkit-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    border: 2px solid #fff; 
    border-radius: 4px; 
    position: relative;
    cursor: pointer;
    outline: none;
    transition: all 0.3s ease;
}
.polls-options:checked {
    background-color: #007bff; 
    border-color: #007bff;
}

.polls-options:checked::before {
    content: "";
    position: absolute;
    top: 4px;
    left: 4px;
    width: 10px;
    height: 10px;
    background-color: white; 
    border-radius: 2px;
    transition: all 0.3s ease;
}
.modal {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1; /* Sit on top */
    left: 0;
    top: 0;
    width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow: auto; /* Enable scroll if needed */
    background-color: rgba(0, 0, 0, 0.4); /* Black w/ opacity */
}

.modal-content {
    background-color: #fefefe;
    margin: 15% auto; /* 15% from the top and centered */
    padding: 20px;
    border: 1px solid #888;
    width: 80%; /* Could be more or less, depending on screen size */
}

.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
}

.close:hover,
.close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}

</style>

    <form method="post" id="vote-form" >
        <div class="titles">
            <div class="banner-container">
                <img src="{% if poll.banner_image %}{{ poll.banner_image.url }}{% else %}/media/path/to/default-image.jpg{% endif %}" alt="{{ poll.title }} banner" class="banner-image">
                <div class="text-overlay">
                    <h2>{{ poll.title }}</h2>
                    <p>{{ poll.description }}</p>
                </div>
            </div>
        </div>
        
        {% csrf_token %}
        {% for option in poll.options.all %}
            <div class="option-container" data-correct="{{ option.is_correct }}">
                <input 
                    type="{% if poll.multi_option %}checkbox{% else %}radio{% endif %}" 
                    name="option{% if poll.multi_option %}[]{% endif %}" 
                    value="{{ option.id }}" 
                    id="option-{{ option.id }}"
                    class="polls-options"
                    {% if user_vote and user_vote.option.id == option.id %}checked{% endif %}
                    {% if poll.poll_type == 'question' %}onclick="checkOption(this)"{% endif %}> 
                <label for="option-{{ option.id }}">{{ option.option_text }}</label>
            </div>
            
        {% empty %}
            <p>No options available.</p>
        {% endfor %}
        <hr>
        <div class="actions">
        {% if not user_vote %}
            <button type="submit">Submit</button>
        {% endif %}
        <a href="{% url 'polls:poll_results' poll.id %}" class="view_result">View Results</a>
        <button id="share-button">Share</button>
    </div>
    </form>
    
    


    {% if poll_link %}
    <!-- Modal Structure -->
    <div id="share-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h4>Share This Poll</h4>
            <p><strong>Link:</strong> <a href="{{ poll_link }}" id="poll-link" target="_blank">{{ poll_link }}</a></p>
            {% if qr_code_url %}
                <p><strong>QR Code:</strong></p>
                <img src="{{ qr_code_url }}" alt="QR Code for Poll Link">
            {% endif %}
            <button id="copy-button">Copy Link</button>
        </div>
    </div>
{% endif %}

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const shareButton = document.getElementById('share-button');
        const modal = document.getElementById('share-modal');
        const closeModal = document.querySelector('.close');
        const copyButton = document.getElementById('copy-button');
        const pollLink = document.getElementById('poll-link').href;

        // Show the modal when the share button is clicked
        shareButton.addEventListener('click', function() {
            modal.style.display = 'block';
        });

        // Close the modal when the 'x' is clicked
        closeModal.addEventListener('click', function() {
            modal.style.display = 'none';
        });

        // Close the modal when clicking outside of the modal content
        window.addEventListener('click', function(event) {
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        });

        // Copy the link to the clipboard
        copyButton.addEventListener('click', function() {
            navigator.clipboard.writeText(pollLink)
                .then(() => {
                    alert('Link copied to clipboard!');
                })
                .catch(err => {
                    console.error('Error copying link: ', err);
                });
        });
    });
</script>

{% endblock %}