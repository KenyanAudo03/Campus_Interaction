{% extends 'polls/base.html' %}

{% block title %}Polls - Create Poll{% endblock %}

{% block content %}
<style>
    h2{
        text-align: center;
        margin-top: 10px;
        font-size: larger;
        font-weight: 800;
    }
form{
    max-width: 600px;
    margin: 0 auto;
    padding: 20px;
    border: 1px solid #000;
    border-radius: 10px;
    margin-top: 15px;
}
/* Slider styling */
.slider {
    width: 100%;
    appearance: none;
    height: 8px;
    background: linear-gradient(to right, red, yellow, green, cyan, blue, magenta, red);
    border-radius: 5px;
    outline: none;
    margin-top: 10px;
}

.slider::-webkit-slider-thumb {
    appearance: none;
    width: 16px;
    height: 16px;
    background-color: #333;
    border-radius: 50%;
    cursor: pointer;
}

.slider::-moz-range-thumb {
    width: 16px;
    height: 16px;
    background-color: #333;
    border-radius: 50%;
    cursor: pointer;
}

.form-title, .form-option, .form-period,  .form-language,
.form-control-file, .form-option-text{
    width: 100%;
    padding: 10px;
    border-radius: 5px;
outline: none;
    font-size: 15px;
}
.form-description{
    width: 100%;
    padding: 10px;
    border-radius: 5px;
    font-size: 15px;
    outline: none;
    resize: none;
    min-height: 50px;
    overflow: hidden;
    display: none !important;
    
}
.description-label{
    color: darkblue;
    font-weight: bold;
    cursor: pointer;
}
.form-title:focus, .form-option:focus, .form-period:focus, .form-image:focus, .form-language:focus,
.form-control-file:focus, .form-option:focus, .form-description:focus, .form-option-text:focus{
    outline: 1px solid blue !important;
}
.options{
padding: 20px;
border: 1px solid #000;
margin-top: 10px;
border-radius: 10px;
display: none;
}
.actions{
    display: flex;
    align-items: center;
    gap: 20px;
    margin-top: 10px;
    margin-bottom: 0;
   
}
.actions button{
    border: none !important;
    font-size: 14px;
    padding: 10px 20px;
    background-color: blue;
    border-radius: 7px;
    cursor: pointer;
    color: #fff;
}

.form-check-input {
    -webkit-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    border: 2px solid #007bff; /* Primary color */
    border-radius: 4px; /* Rounded corners */
    position: relative;
    cursor: pointer;
    outline: none;
    transition: all 0.3s ease;
}

/* Styling for when the checkbox is checked */
.form-check-input:checked {
    background-color: #007bff; /* Background color when checked */
    border-color: #007bff;
}

/* Checkmark style */
.form-check-input:checked::before {
    content: "";
    position: absolute;
    top: 4px;
    left: 4px;
    width: 10px;
    height: 10px;
    background-color: white; /* Checkmark color */
    border-radius: 2px;
    transition: all 0.3s ease;
}

/* Add a subtle box-shadow on focus */
.form-check-input:focus {
    box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
}


</style>
<h2>Create a New Poll</h2>
<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="mb-3">
        <div class="input-container">
            {{ poll_form.title.label_tag }}
            {{ poll_form.title }}
            {% if poll_form.title.errors %}
                <div class="text-danger">{{ poll_form.title.errors }}</div>
            {% endif %}
        </div>
    </div>
    <br>
    <div class="mb-3">
        <div class="input-container">
            <label for="id_description" class="description-label" id="description-label">
                Add Description (optional):
            </label>
            {{ poll_form.description }}
            <div id="description-error" class="text-danger">
                {% for error in poll_form.description.errors %}
                    {{ error }}
                {% endfor %}
            </div>
        </div>
    </div>
    <br>
    {{ option_formset.management_form }}
    <div id="option-formset">
        {% for form in option_formset %}
            <div class="option-form">
                <label for="{{ form.option_text.id_for_label }}">Option Text:</label>
                {{ form.option_text }}
<br>
                <div class="correct-answer {% if poll_form.instance.poll_type != 'question' %} hidden {% endif %}">
                    <label class="correct-answer-label">
                        {{ form.is_correct }} Mark as correct
                    </label>
                </div>
                
            </div>
            <br>
        {% endfor %}
    </div>

    

<div class="actions">
<button type="button" id="add-option">Add Option<i class='bx bx-plus'></i></button>
<button type="button" id="toggle-options">Options<i class='bx bx-cog'></i></button>
<button type="submit" class="btn btn-primary">Save<i class='bx bx-save' ></i></button>
</div>
<div class="options">
    <div class="mb-3">
        {{ poll_form.poll_type.label_tag }}
        {{ poll_form.poll_type }}
        {% if poll_form.poll_type.errors %}
            <div class="text-danger">{{ poll_form.poll_type.errors }}</div>
        {% endif %}
    </div><br>


   <div class="form-check mb-3">  
    {{ poll_form.allow_expiration.label_tag }}
    {{ poll_form.allow_expiration }}
    {% if poll_form.allow_expiration.errors %}
        <div class="text-danger">{{ poll_form.allow_expiration.errors }}</div>
    {% endif %}
</div>

<div class="mb-3 expiration-fields" style="display: none;">
    {{ poll_form.expiration_time.label_tag }}
    {{ poll_form.expiration_time }}
    {% if poll_form.expiration_time.errors %}
        <div class="text-danger">{{ poll_form.expiration_time.errors }}</div>
    {% endif %}
</div><br>


    <div class="form-check mb-3">
        
        {{ poll_form.multi_option.label_tag }}
        {{ poll_form.multi_option }}
        {% if poll_form.allow_expiration.errors %}
            <div class="text-danger">{{ poll_form.allow_expiration.errors }}</div>
        {% endif %}
    </div><br>
    <div class="form-check mb-3">
  
        {{ poll_form.show_share_button.label_tag }}
        {{ poll_form.show_share_button }}
        {% if poll_form.allow_expiration.errors %}
            <div class="text-danger">{{ poll_form.allow_expiration.errors }}</div>
        {% endif %}
    </div><br>
    <div class="form-check mb-3">
        <label for="background-color-slider">Background Color:</label>
        <input type="range" id="background-color-slider" min="0" max="360" value="0" class="slider">
        <input type="color" id="background-color-picker" class="form-image" name="background_color">
    </div>
    <br>
    <div class="form-check mb-3">
        {{ poll_form.banner_image.label_tag }}
        {{ poll_form.banner_image }}
        {% if poll_form.allow_expiration.errors %}
            <div class="text-danger">{{ poll_form.allow_expiration.errors }}</div>
        {% endif %}
    </div><br>
</div>

</div>
</form>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        const descriptionInput = document.querySelector('.form-description'); // Target the textarea by its class
        const descriptionLabel = document.getElementById('description-label');

        // Toggle visibility when the label is clicked
        descriptionLabel.addEventListener('click', function() {
            // Toggle the display property
            if (descriptionInput.style.display === 'none' || descriptionInput.style.display === '') {
                descriptionInput.style.display = 'block'; // Show textarea
                descriptionInput.focus(); // Focus on the textarea when shown
            } else {
                descriptionInput.style.display = 'none'; // Hide textarea
            }
        });
    });
</script>


<script>
    // Get the button and options elements
    const toggleButton = document.getElementById("toggle-options");
    const optionsDiv = document.querySelector(".options");

    // Add click event listener to the button
    toggleButton.addEventListener("click", function() {
        // Toggle the 'display' property
        if (optionsDiv.style.display === "none" || optionsDiv.style.display === "") {
            optionsDiv.style.display = "block";
        } else {
            optionsDiv.style.display = "none";
        }
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const allowExpirationCheckbox = document.querySelector('input[name="allow_expiration"]');
        const expirationFields = document.querySelector('.expiration-fields');
    
        // Function to toggle expiration fields
        function toggleExpirationFields() {
            if (allowExpirationCheckbox.checked) {
                expirationFields.style.display = 'block';
            } else {
                expirationFields.style.display = 'none';
            }
        }
    
        // Initial toggle based on the checkbox state on page load
        toggleExpirationFields();
    
        // Add event listener to the checkbox
        allowExpirationCheckbox.addEventListener('change', toggleExpirationFields);
    });
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const slider = document.getElementById('background-color-slider');
        const colorPicker = document.getElementById('background-color-picker');
    
        // Function to convert hue to hex color
        function hslToHex(hue) {
            const saturation = 100;
            const lightness = 50;
            let chroma = (1 - Math.abs(2 * lightness / 100 - 1)) * (saturation / 100);
            let x = chroma * (1 - Math.abs((hue / 60) % 2 - 1));
            let m = lightness / 100 - chroma / 2;
            let [r, g, b] = (hue < 60) ? [chroma, x, 0]
                        : (hue < 120) ? [x, chroma, 0]
                        : (hue < 180) ? [0, chroma, x]
                        : (hue < 240) ? [0, x, chroma]
                        : (hue < 300) ? [x, 0, chroma]
                        : [chroma, 0, x];
            [r, g, b] = [Math.round((r + m) * 255), Math.round((g + m) * 255), Math.round((b + m) * 255)];
            return `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1)}`;
        }
    
        // Update color picker when slider is changed
        slider.addEventListener('input', function() {
            const hue = slider.value;
            colorPicker.value = hslToHex(hue);
        });
    });
    </script>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const textarea = document.getElementById('description');
    
        // Function to adjust the height
        function adjustHeight() {
            this.style.height = 'auto'; // Reset height to auto to calculate new height
            this.style.height = this.scrollHeight + 'px'; // Set height to scroll height
        }
    
        // Adjust height on input
        textarea.addEventListener('input', adjustHeight);
    
        // Optionally, adjust height on page load if there's already content
        adjustHeight.call(textarea);
    });
    </script>
    

<script>
    document.addEventListener('DOMContentLoaded', function() {
    const pollTypeElement = document.querySelector('#id_poll_type');
    const optionFormsetContainer = document.getElementById('option-formset');
    const addOptionButton = document.getElementById('add-option');
    const totalFormsInput = document.querySelector('#id_form-TOTAL_FORMS');

    function toggleCorrectAnswerCheckbox() {
        const pollType = pollTypeElement.value;
        const correctAnswerLabels = document.querySelectorAll('.correct-answer');
        
        correctAnswerLabels.forEach(label => {
            label.style.display = pollType === 'question' ? 'block' : 'none';
        });
    }

    // Initial toggle based on current poll type
    toggleCorrectAnswerCheckbox();

    // Listen for changes in the poll type dropdown to apply toggle function
    pollTypeElement.addEventListener('change', toggleCorrectAnswerCheckbox);

    addOptionButton.addEventListener('click', function() {
        // Get the current count of option forms
        const formCount = parseInt(totalFormsInput.value, 10);

        // Create a new option form HTML
        const newFormHtml = `
            <div class="option-form">
                <label>Option Text:</label>
                <input type="text" name="form-${formCount}-option_text" maxlength="100" class="form-option-text" placeholder="Enter option text" required>
                <div class="correct-answer" style="display: ${pollTypeElement.value === 'question' ? 'block' : 'none'};">
                    <label><input type="checkbox" name="form-${formCount}-is_correct" class="form-check-input"> Mark as correct</label>
                </div>
            </div>
            <br>
        `;

        // Insert the new form HTML into the formset container
        optionFormsetContainer.insertAdjacentHTML('beforeend', newFormHtml);

        // Update the TOTAL_FORMS hidden input to reflect the new number of forms
        totalFormsInput.value = formCount + 1;
    });
});

</script>
{% endblock %}